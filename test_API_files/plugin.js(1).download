CKEDITOR.plugins.add("kitattachment",{icons:"kitattachment",requires:"uploadwidget,link",init:function(t){var e=CKEDITOR.fileTools,i=t.config,a=e.getUploadUrl(i),l=(t.lang.image2,CKEDITOR.plugins.kitattachment);a?(i.deleteUploadUrl&&l.initFileDeleteEvent(t),t.addCommand("kitattachment",{exec:function(t){l.handleFileUpload(t)}}),t.ui.addButton("KitAttachment",{label:I18n.t("ckeditor.kituploadfile_label"),command:"kitattachment",toolbar:"insert"})):CKEDITOR.error("uploadfile-config")}}),CKEDITOR.plugins.kitattachment={handleFileUpload:function(t){$('<input type="file" multiple="multiple" style="display:none;"/>').appendTo("body").click().change((function(e){for(var i=this.files,a=CKEDITOR.fileTools,l=t.config,n=a.getUploadUrl(l),o=CKEDITOR.plugins.kitattachment,c=0;c<i.length;c++){var d=i[0],s=t.uploadRepository.create(d);s.upload(n),CKEDITOR.fileTools.bindNotifications(t,s),s.on("uploaded",(function(e){var i;i=_.get(e,"target.response")?JSON.parse(_.get(e,"target.response")):_.get(e,"sender.responseData"),o.showAttachement(t,i)}))}}))},initFileDeleteEvent:function(t){$(document).off("click",".delete-upload"),$(document).on("click",".delete-upload",(function(e){var i=e.target,a=$(e.target).closest("li").data().id;$.ajax({url:t.config.deleteUploadUrl+"&upload_id="+a,type:"DELETE"}).done((function(t){$(i).closest("li").hide((function(){$(this).remove()}))})).fail((function(e){t.showNotification(I18n.t("ckeditor.error_deleting"),"warning")})).always((function(){}))}))},showAttachement:function(t,e){var i=t.config.display_class||"attachments-index",a=t.config.display_id,l="[class="+i+"]";a&&(l+="[id="+a+"]"),$(l).append(this.attachmentTemplate(e)),$("li[data-id="+e.id+"]").show((function(){$(this).css("overflow","visible")}))},attachmentTemplate:function(t){return'<li class="tag tag--outlined-gray" data-id="'+t.id+'" style="display:none"><i class="icon-paperclip inline"></i><a href="'+t.url+'" target="_blank" class="soft-quarter--left">'+t.filename+'</a><a href="javascript:void(0)" class="delete-upload"><i class="icon-multiply soft-half--left icon-size--070"></i></a></li>'}};